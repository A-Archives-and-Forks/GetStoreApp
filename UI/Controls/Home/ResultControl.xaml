<UserControl
    x:Class="GetStoreApp.UI.Controls.Home.ResultControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ctWinUI="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid
        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
        CornerRadius="{ThemeResource ColorPickerSliderCornerRadius}"
        Visibility="{x:Bind ViewModel.ResultControlVisable, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid
            Grid.Row="0"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            Style="{StaticResource DataGridDescriptionGridStyle}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <FontIcon
                Grid.Column="0"
                FontFamily="Segoe Fluent Icons"
                Glyph="&#xE71e;"
                Style="{StaticResource FontIconStyle}" />

            <TextBlock
                Grid.Column="1"
                VerticalAlignment="Center"
                Text="{x:Bind ResourceService.GetLocalized('/Home/SearchResult')}" />

            <AppBarSeparator Grid.Column="2" Margin="10,0,10,0" />

            <StackPanel
                Grid.Column="3"
                VerticalAlignment="Center"
                Visibility="{x:Bind ViewModel.ResultDataList.Count, Converter={StaticResource IntToVisibilityConverter}, Mode=OneWay}">
                <TextBlock Text="{x:Bind LocalizedCategoryId(ViewModel.CategoryId), Mode=OneWay}" />
                <TextBlock Text="{x:Bind LocalizedResultCountInfo(ViewModel.ResultDataList.Count), Mode=OneWay}" />
            </StackPanel>

            <TextBlock
                Grid.Column="3"
                VerticalAlignment="Center"
                Text="{x:Bind ResourceService.GetLocalized('/Home/SearchResultEmpty')}"
                Visibility="{x:Bind ViewModel.ResultDataList.Count, Converter={StaticResource IntToReverseVisibilityConverter}, Mode=OneWay}" />

            <CommandBar
                Grid.Column="4"
                VerticalAlignment="Center"
                Background="Transparent"
                DefaultLabelPosition="Right"
                Visibility="{x:Bind ViewModel.IsSelectMode, Converter={StaticResource BooleanToReverseVisibilityConverter}, Mode=OneWay}">

                <AppBarButton
                    Icon="Copy"
                    Label="{x:Bind ResourceService.GetLocalized('/Home/Copy')}"
                    ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/Copy')}">

                    <AppBarButton.Flyout>

                        <MenuFlyout Placement="Bottom">
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.CopyCategoryIDCommand}"
                                Text="{x:Bind ResourceService.GetLocalized('/Home/CopyCategoryID')}"
                                ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/CopyCategoryID')}" />
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.CopyLinkCommand}"
                                Text="{x:Bind ResourceService.GetLocalized('/Home/CopyLink')}"
                                ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/CopyLink')}" />
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.CopyContentCommand}"
                                Text="{x:Bind ResourceService.GetLocalized('/Home/CopyContent')}"
                                ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/CopyContent')}" />
                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>

                <AppBarButton
                    Command="{x:Bind ViewModel.DownloadCommand}"
                    IsEnabled="False"
                    Label="{x:Bind ResourceService.GetLocalized('/Home/Download')}"
                    ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/Download')}">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE74b;" />
                    </AppBarButton.Icon>
                </AppBarButton>

                <AppBarButton
                    Command="{x:Bind ViewModel.SelectCommand}"
                    Icon="Bullets"
                    Label="{x:Bind ResourceService.GetLocalized('/Home/Select')}"
                    ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/Select')}" />
            </CommandBar>

            <CommandBar
                Grid.Column="4"
                VerticalAlignment="Center"
                Background="Transparent"
                DefaultLabelPosition="Right"
                Visibility="{x:Bind ViewModel.IsSelectMode, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">

                <AppBarButton
                    Command="{x:Bind ViewModel.SelectAllCommand}"
                    Icon="SelectAll"
                    Label="{x:Bind ResourceService.GetLocalized('/Home/SelectAll')}"
                    ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/SelectAll')}" />

                <AppBarButton
                    Command="{x:Bind ViewModel.SelectNoneCommand}"
                    Icon="ClearSelection"
                    Label="{x:Bind ResourceService.GetLocalized('/Home/SelectNone')}"
                    ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/SelectNone')}" />

                <AppBarButton
                    Icon="Copy"
                    Label="{x:Bind ResourceService.GetLocalized('/Home/CopySelected')}"
                    ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/CopySelected')}">

                    <AppBarButton.Flyout>
                        <MenuFlyout Placement="Bottom">
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.CopySelectedLinkCommand}"
                                Text="{x:Bind ResourceService.GetLocalized('/Home/CopySelectedLink')}"
                                ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/CopySelectedLink')}" />
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.CopySelectedCommand}"
                                Text="{x:Bind ResourceService.GetLocalized('/Home/CopySelectedContent')}"
                                ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/CopySelectedContent')}" />
                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>

                <AppBarButton
                    Command="{x:Bind ViewModel.DownloadSelectedCommand}"
                    IsEnabled="False"
                    Label="{x:Bind ResourceService.GetLocalized('/Home/DownloadSelected')}"
                    ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/DownloadSelected')}">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE74b;" />
                    </AppBarButton.Icon>
                </AppBarButton>

                <AppBarButton
                    Command="{x:Bind ViewModel.CancelCommand}"
                    Icon="Cancel"
                    Label="{x:Bind ResourceService.GetLocalized('/Home/Cancel')}"
                    ToolTipService.ToolTip="{x:Bind ResourceService.GetLocalized('/Home/Cancel')}" />
            </CommandBar>
        </Grid>

        <ctWinUI:DataGrid
            x:Name="ResultDataGrid"
            Grid.Row="1"
            DataContext="{x:Bind ViewModel}"
            ItemsSource="{x:Bind ViewModel.ResultDataList, Mode=OneWay}"
            RowStyle="{StaticResource DataGridRowStyle}"
            SelectedItem="{x:Bind ViewModel.SelectedResultItem, Mode=TwoWay}"
            Style="{StaticResource DataGridResultStyle}"
            Visibility="{x:Bind ViewModel.ResultDataList.Count, Converter={StaticResource IntToVisibilityConverter}, Mode=OneWay}">

            <ctWinUI:DataGrid.Columns>

                <ctWinUI:DataGridTemplateColumn
                    Width="Auto"
                    Header="{x:Bind ResourceService.GetLocalized('/Home/Select')}"
                    HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                    IsReadOnly="False"
                    Visibility="{x:Bind ViewModel.IsSelectMode, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">

                    <ctWinUI:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox
                                Margin="12,0,0,0"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                IsThreeState="False"
                                Style="{StaticResource CheckBoxStyle}" />
                        </DataTemplate>
                    </ctWinUI:DataGridTemplateColumn.CellTemplate>
                </ctWinUI:DataGridTemplateColumn>

                <ctWinUI:DataGridTemplateColumn
                    Width="4*"
                    Header="{x:Bind ResourceService.GetLocalized('/Home/FileName')}"
                    HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                    IsReadOnly="True">
                    <ctWinUI:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <HyperlinkButton
                                Margin="12,0,0,0"
                                VerticalAlignment="Center"
                                Command="{Binding FileOperationCommand}"
                                CommandParameter="{Binding FileLink}"
                                Content="{Binding FileName}"
                                Style="{StaticResource HyperlinkButtonStyle}"
                                ToolTipService.ToolTip="{Binding FileName}" />
                        </DataTemplate>
                    </ctWinUI:DataGridTemplateColumn.CellTemplate>
                </ctWinUI:DataGridTemplateColumn>

                <ctWinUI:DataGridTextColumn
                    Width="Auto"
                    Binding="{Binding FileLinkExpireTime, Converter={StaticResource GMTFormatConverter}}"
                    Header="{x:Bind ResourceService.GetLocalized('/Home/LinkExpireTime')}"
                    HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                    IsReadOnly="True" />

                <ctWinUI:DataGridTextColumn
                    Width="3*"
                    Binding="{Binding FileSHA1}"
                    Header="{x:Bind ResourceService.GetLocalized('/Home/FileSHA1')}"
                    HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                    IsReadOnly="True" />

                <ctWinUI:DataGridTextColumn
                    Width="Auto"
                    Binding="{Binding FileSize}"
                    Header="{x:Bind ResourceService.GetLocalized('/Home/FileSize')}"
                    HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                    IsReadOnly="True" />
            </ctWinUI:DataGrid.Columns>
        </ctWinUI:DataGrid>
    </Grid>
</UserControl>
