<Page
    x:Class="GetStoreApp.Views.HistoryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ctWinUI="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:service="using:GetStoreApp.Services.Settings"
    xmlns:ic="using:Microsoft.Xaml.Interactions.Core"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    NavigationCacheMode="Enabled"
    mc:Ignorable="d">

    <i:Interaction.Behaviors>
        <ic:EventTriggerBehavior EventName="Loaded">
            <ic:InvokeCommandAction Command="{x:Bind ViewModel.LoadedCommand}" />
        </ic:EventTriggerBehavior>
    </i:Interaction.Behaviors>

    <Grid Margin="30,15,30,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock
            Grid.Row="0"
            Margin="0,0,0,10"
            FontSize="{StaticResource TitleFontSize}"
            Text="{x:Bind service:LanguageService.GetResources('/History/Title')}" />

        <Grid
            Grid.Row="1"
            Margin="0,0,0,10"
            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            Style="{StaticResource DataGridDescriptionGridStyle}">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <FontIcon
                Grid.Column="0"
                FontFamily="Segoe Fluent Icons"
                Glyph="&#xE74C;"
                Style="{StaticResource FontIconStyle}" />
            <TextBlock
                Grid.Column="1"
                VerticalAlignment="Center"
                Text="{x:Bind service:LanguageService.GetResources('/History/Operation')}" />
            <AppBarSeparator Grid.Column="2" Margin="10,0,10,0" />

            <TextBlock
                Grid.Column="3"
                VerticalAlignment="Center"
                Text="{x:Bind ViewModel.HistoryDataList.Count, Converter={StaticResource HistoryCountInfoFormatConverter}, Mode=OneWay}" />

            <CommandBar
                Grid.Column="4"
                VerticalAlignment="Center"
                Background="Transparent"
                DefaultLabelPosition="Right"
                Visibility="{x:Bind ViewModel.IsSelectMode, Converter={StaticResource BooleanToReverseVisibilityConverter}, Mode=OneWay}">

                <AppBarButton
                    Command="{x:Bind ViewModel.FillinCommand}"
                    Icon="Up"
                    Label="{x:Bind service:LanguageService.GetResources('/History/Fillin')}"
                    ToolTipService.ToolTip="{x:Bind service:LanguageService.GetResources('/History/FillinDescription')}" />

                <AppBarButton
                    Command="{x:Bind ViewModel.CopyCommand}"
                    Icon="Copy"
                    Label="{x:Bind service:LanguageService.GetResources('/History/Copy')}" />

                <AppBarButton Command="{x:Bind ViewModel.SelectCommand}" Label="{x:Bind service:LanguageService.GetResources('/History/Select')}">
                    <AppBarButton.Icon>
                        <FontIcon
                            Grid.Column="0"
                            FontFamily="Segoe Fluent Icons"
                            Glyph="&#xE762;" />
                    </AppBarButton.Icon>
                </AppBarButton>

                <AppBarButton Icon="Sort" Label="{x:Bind service:LanguageService.GetResources('/History/Sort')}">
                    <AppBarButton.Flyout>
                        <MenuFlyout Placement="Bottom">

                            <RadioMenuFlyoutItem
                                Command="{x:Bind ViewModel.TimeSortCommand}"
                                CommandParameter="true"
                                IsChecked="{x:Bind ViewModel.TimeSortOrder, Converter={StaticResource TimeSortValueCheckConverter}, ConverterParameter=true, Mode=OneWay}"
                                Text="{x:Bind service:LanguageService.GetResources('/History/TimeIncreaseSort')}">
                                <RadioMenuFlyoutItem.Icon>
                                    <FontIcon
                                        Grid.Column="0"
                                        FontFamily="Segoe Fluent Icons"
                                        Glyph="&#xE74a;" />
                                </RadioMenuFlyoutItem.Icon>
                            </RadioMenuFlyoutItem>

                            <RadioMenuFlyoutItem
                                Command="{x:Bind ViewModel.TimeSortCommand}"
                                CommandParameter="false"
                                IsChecked="{x:Bind ViewModel.TimeSortOrder, Converter={StaticResource TimeSortValueCheckConverter}, ConverterParameter=false, Mode=OneWay}"
                                Text="{x:Bind service:LanguageService.GetResources('/History/TimeDecreaseSort')}">
                                <RadioMenuFlyoutItem.Icon>
                                    <FontIcon
                                        Grid.Column="0"
                                        FontFamily="Segoe Fluent Icons"
                                        Glyph="&#xE74b;" />
                                </RadioMenuFlyoutItem.Icon>
                            </RadioMenuFlyoutItem>
                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>

                <AppBarButton Icon="Filter" Label="{x:Bind service:LanguageService.GetResources('/History/Filter')}">
                    <AppBarButton.Flyout>

                        <MenuFlyout Placement="Bottom">
                            <MenuFlyoutSubItem Text="{x:Bind service:LanguageService.GetResources('/History/Type')}">
                                <RadioMenuFlyoutItem
                                    Command="{x:Bind ViewModel.TypeFilterCommand}"
                                    CommandParameter="url"
                                    GroupName="TypeFilter"
                                    IsChecked="{x:Bind ViewModel.TypeFilter, Converter={StaticResource FilterValueCheckConverter}, ConverterParameter=url, Mode=OneWay}"
                                    Text="{x:Bind service:LanguageService.GetResources('URL')}" />
                                <RadioMenuFlyoutItem
                                    Command="{x:Bind ViewModel.TypeFilterCommand}"
                                    CommandParameter="ProductId"
                                    GroupName="TypeFilter"
                                    IsChecked="{x:Bind ViewModel.TypeFilter, Converter={StaticResource FilterValueCheckConverter}, ConverterParameter=ProductId, Mode=OneWay}"
                                    Text="{x:Bind service:LanguageService.GetResources('ProductID')}" />
                                <RadioMenuFlyoutItem
                                    Command="{x:Bind ViewModel.TypeFilterCommand}"
                                    CommandParameter="PackageFamilyName"
                                    GroupName="TypeFilter"
                                    IsChecked="{x:Bind ViewModel.TypeFilter, Converter={StaticResource FilterValueCheckConverter}, ConverterParameter=PackageFamilyName, Mode=OneWay}"
                                    Text="{x:Bind service:LanguageService.GetResources('PackageFamilyName')}" />
                                <RadioMenuFlyoutItem
                                    Command="{x:Bind ViewModel.TypeFilterCommand}"
                                    CommandParameter="CategoryId"
                                    GroupName="TypeFilter"
                                    IsChecked="{x:Bind ViewModel.TypeFilter, Converter={StaticResource FilterValueCheckConverter}, ConverterParameter=CategoryId, Mode=OneWay}"
                                    Text="{x:Bind service:LanguageService.GetResources('CategoryID')}" />
                                <MenuFlyoutSeparator />
                                <RadioMenuFlyoutItem
                                    Command="{x:Bind ViewModel.TypeFilterCommand}"
                                    CommandParameter="None"
                                    GroupName="TypeFilter"
                                    IsChecked="{x:Bind ViewModel.TypeFilter, Converter={StaticResource FilterValueCheckConverter}, ConverterParameter=None, Mode=OneWay}"
                                    Text="{x:Bind service:LanguageService.GetResources('/History/None')}" />
                            </MenuFlyoutSubItem>

                            <MenuFlyoutSubItem Text="{x:Bind service:LanguageService.GetResources('/History/Channel')}">
                                <RadioMenuFlyoutItem
                                    Command="{x:Bind ViewModel.ChannelFilterCommand}"
                                    CommandParameter="WIF"
                                    GroupName="ChannelFilter"
                                    IsChecked="{x:Bind ViewModel.ChannelFilter, Converter={StaticResource FilterValueCheckConverter}, ConverterParameter=WIF, Mode=OneWay}"
                                    Text="{x:Bind service:LanguageService.GetResources('Fast')}" />
                                <RadioMenuFlyoutItem
                                    Command="{x:Bind ViewModel.ChannelFilterCommand}"
                                    CommandParameter="WIS"
                                    GroupName="ChannelFilter"
                                    IsChecked="{x:Bind ViewModel.ChannelFilter, Converter={StaticResource FilterValueCheckConverter}, ConverterParameter=WIS, Mode=OneWay}"
                                    Text="{x:Bind service:LanguageService.GetResources('Slow')}" />
                                <RadioMenuFlyoutItem
                                    Command="{x:Bind ViewModel.ChannelFilterCommand}"
                                    CommandParameter="RP"
                                    GroupName="ChannelFilter"
                                    IsChecked="{x:Bind ViewModel.ChannelFilter, Converter={StaticResource FilterValueCheckConverter}, ConverterParameter=RP, Mode=OneWay}"
                                    Text="{x:Bind service:LanguageService.GetResources('RP')}" />
                                <RadioMenuFlyoutItem
                                    Command="{x:Bind ViewModel.ChannelFilterCommand}"
                                    CommandParameter="Retail"
                                    GroupName="ChannelFilter"
                                    IsChecked="{x:Bind ViewModel.ChannelFilter, Converter={StaticResource FilterValueCheckConverter}, ConverterParameter=Retail, Mode=OneWay}"
                                    Text="{x:Bind service:LanguageService.GetResources('Retail')}" />
                                <MenuFlyoutSeparator />
                                <RadioMenuFlyoutItem
                                    Command="{x:Bind ViewModel.ChannelFilterCommand}"
                                    CommandParameter="None"
                                    GroupName="ChannelFilter"
                                    IsChecked="{x:Bind ViewModel.ChannelFilter, Converter={StaticResource FilterValueCheckConverter}, ConverterParameter=None, Mode=OneWay}"
                                    Text="{x:Bind service:LanguageService.GetResources('/History/None')}" />
                            </MenuFlyoutSubItem>
                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>

                <AppBarButton
                    Command="{x:Bind ViewModel.RefreshCommand}"
                    Icon="Refresh"
                    Label="{x:Bind service:LanguageService.GetResources('/History/Refresh')}" />
            </CommandBar>

            <CommandBar
                Grid.Column="4"
                VerticalAlignment="Center"
                Background="Transparent"
                DefaultLabelPosition="Right"
                Visibility="{x:Bind ViewModel.IsSelectMode, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">

                <AppBarButton
                    Command="{x:Bind ViewModel.SelectAllCommand}"
                    Icon="SelectAll"
                    Label="{x:Bind service:LanguageService.GetResources('/History/SelectAll')}" />

                <AppBarButton
                    Command="{x:Bind ViewModel.SelectNoneCommand}"
                    Icon="ClearSelection"
                    Label="{x:Bind service:LanguageService.GetResources('/History/SelectNone')}" />

                <AppBarButton
                    Command="{x:Bind ViewModel.CopySelectedCommand}"
                    Icon="Copy"
                    Label="{x:Bind service:LanguageService.GetResources('/History/CopySelected')}" />

                <AppBarButton
                    Command="{x:Bind ViewModel.DeleteCommand}"
                    Icon="Delete"
                    Label="{x:Bind service:LanguageService.GetResources('/History/Delete')}" />

                <AppBarButton
                    Command="{x:Bind ViewModel.CancelCommand}"
                    Icon="Cancel"
                    Label="{x:Bind service:LanguageService.GetResources('/History/Cancel')}" />
            </CommandBar>
        </Grid>

        <Grid
            Grid.Row="2"
            Margin="0,0,0,10"
            Style="{StaticResource CardGridStyle}"
            Visibility="{x:Bind ViewModel.IsHistoryEmpty, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">
            <TextBlock
                Margin="0,10,0,10"
                VerticalAlignment="Center"
                Text="{x:Bind service:LanguageService.GetResources('/History/HistoryEmptyDescription')}"
                TextAlignment="Center" />
        </Grid>

        <Grid Grid.Row="3" Visibility="{x:Bind ViewModel.IsHistoryEmpty, Converter={StaticResource BooleanToReverseVisibilityConverter}, Mode=OneWay}">

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Grid
                Grid.Row="0"
                Style="{StaticResource CardGridStyle}"
                Visibility="{x:Bind ViewModel.IsHistoryEmptyAfterFilter, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">
                <TextBlock
                    Margin="0,10,0,10"
                    VerticalAlignment="Center"
                    Text="{x:Bind service:LanguageService.GetResources('/History/HistoryFilterEmptyDescription')}"
                    TextAlignment="Center" />
            </Grid>

            <ctWinUI:DataGrid
                Grid.Row="1"
                ItemsSource="{x:Bind ViewModel.HistoryDataList, Mode=OneWay}"
                RowStyle="{StaticResource DataGridRowStyle}"
                SelectedItem="{x:Bind ViewModel.SelectedHistoryItem, Mode=TwoWay}"
                Style="{StaticResource DataGridHistoryStyle}"
                Visibility="{x:Bind ViewModel.IsHistoryEmptyAfterFilter, Converter={StaticResource BooleanToReverseVisibilityConverter}, Mode=OneWay}">

                <i:Interaction.Behaviors>
                    <ic:EventTriggerBehavior EventName="DoubleTapped">
                        <ic:InvokeCommandAction Command="{x:Bind ViewModel.FillinCommand}" />
                    </ic:EventTriggerBehavior>
                </i:Interaction.Behaviors>

                <ctWinUI:DataGrid.Columns>

                    <ctWinUI:DataGridTemplateColumn
                        Width="80"
                        Header="{x:Bind service:LanguageService.GetResources('/History/Select')}"
                        HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                        IsReadOnly="False"
                        Visibility="{x:Bind ViewModel.IsSelectMode, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">

                        <ctWinUI:DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox
                                    Margin="12,0,0,0"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                    IsThreeState="False" />
                            </DataTemplate>
                        </ctWinUI:DataGridTemplateColumn.CellTemplate>
                    </ctWinUI:DataGridTemplateColumn>

                    <ctWinUI:DataGridTextColumn
                        Width="1.5*"
                        Binding="{Binding CurrentTimeStamp, Converter={StaticResource TimeStampFormatConverter}}"
                        Header="{x:Bind service:LanguageService.GetResources('/History/DateTime')}"
                        HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                        IsReadOnly="True"
                        ToolTipService.ToolTip="{x:Bind service:LanguageService.GetResources('/History/DoubleTapToInput')}" />

                    <ctWinUI:DataGridTextColumn
                        Width="*"
                        Binding="{Binding HistoryType, Converter={StaticResource TypeNameFormatConverter}}"
                        Header="{x:Bind service:LanguageService.GetResources('/History/Type')}"
                        HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                        IsReadOnly="True"
                        ToolTipService.ToolTip="{x:Bind service:LanguageService.GetResources('/History/DoubleTapToInput')}" />

                    <ctWinUI:DataGridTextColumn
                        Width="*"
                        Binding="{Binding HistoryChannel, Converter={StaticResource ChannelNameFormatConverter}}"
                        Header="{x:Bind service:LanguageService.GetResources('/History/Channel')}"
                        HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                        IsReadOnly="True"
                        ToolTipService.ToolTip="{x:Bind service:LanguageService.GetResources('/History/DoubleTapToInput')}" />

                    <ctWinUI:DataGridTextColumn
                        Width="3*"
                        Binding="{Binding HistoryLink}"
                        Header="{x:Bind service:LanguageService.GetResources('/History/Link')}"
                        HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                        IsReadOnly="True"
                        ToolTipService.ToolTip="{x:Bind service:LanguageService.GetResources('/History/DoubleTapToInput')}" />
                </ctWinUI:DataGrid.Columns>
            </ctWinUI:DataGrid>
        </Grid>
    </Grid>
</Page>
